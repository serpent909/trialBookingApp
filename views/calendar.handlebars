<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Booked Times Calendar</title>
</head>

<body>
    <div id="calendar"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js'></script>
    <style>
        #calendar {
            padding-top: 20px;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var bookedTimesJSON = `{{{bookedTimesJSON}}}`; // Get the JSON string from the template

            console.log(bookedTimesJSON)

            // Parse the JSON string to obtain the bookedTimes array
            var bookedTimes = JSON.parse(bookedTimesJSON);




            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridWeek',
                events: bookedTimes.map(function (event) {
                    event.start = moment(event.start, 'YYYY-MM-DD hh:mm:ss').format('YYYY-MM-DDTHH:mm:ss');
                    event.end = moment(event.end, 'YYYY-MM-DD hh:mm:ss').format('YYYY-MM-DDTHH:mm:ss');
            

                    return {
                        title: event.name,
                        start: event.start, // Start time
                        end: event.end, 
                        participantId: event.participantId    

                    };
                }),

                headerToolbar: {
                    right: 'prev,next today',
                    center: 'title',
                    left: 'dayGridMonth,dayGridWeek,dayGridDay'
                },

                eventTimeFormat: {
                    hour: 'numeric',
                    minute: '2-digit',
                    meridiem: 'short'
                },
                eventDisplay: 'block',
                displayEventEnd: 'true',
                eventContent: function (arg) {
                    // Create a custom event content HTML element
                    var eventContentEl = document.createElement('div');
                    eventContentEl.classList.add('event-content');

                    // Title element
                    var titleEl = document.createElement('div');
                    titleEl.classList.add('event-title');
                    titleEl.textContent = arg.event.title;
                    eventContentEl.appendChild(titleEl);

                    // Time element
                    var timeEl = document.createElement('div');
                    timeEl.classList.add('event-time');
                    timeEl.textContent = moment(arg.event.start).format('h:mma') + ' - ' + moment(arg.event.end).format('h:mma');
                    eventContentEl.appendChild(timeEl);

                    var participantIdEl1 = document.createElement('div');
                    participantIdEl1.classList.add('event-participantId');
                    participantIdEl1.textContent = "Participant: " + arg.event.extendedProps.participantId;
                    eventContentEl.appendChild(participantIdEl1);



                    return { domNodes: [eventContentEl] };
                },

            });

            calendar.render();
        });
    </script>
</body>

</html>